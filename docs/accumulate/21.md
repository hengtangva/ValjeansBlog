# 浅谈闭包

## 什么是闭包

先看 MDN 上的解释：    

一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）    

也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域。在 JavaScript 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来。    

如果这样理解还有问题，我们先来看一个例子吧：    

```js
function add() {
  let count = 0;
  return function() {
      count = count + 1;
      return count;
  }
}
let sum = add();
let add1 = sum();
let add2 = sum();
let add3 = sum();
console.log(add1); // 1
console.log(add2); // 2
console.log(add3); // 3
```

我们在这里想说明的是，如果按照正常理解，add() 函数执行完过后，其上下文应该是销毁的。    

但是，在这里，我们看到的是，count 这个变量被保存了下来。    

这就是闭包在起作用了，它让 count 的声明周期变长了。    

我们可以想象闭包就是函数的一个小背包，在函数创建时，它所需要的变量都装进这个小背包里。    

当创建它的上下文销毁时（这里是创建它的函数执行完毕），只要函数引用还在，这个背包就一直跟着函数。    

这样，函数想执行的时候，就始终有变量给它用，让它更好的执行了。    

---

再回到我们的 MDN 定义上，可以这么理解，和函数有关的变量我们就自动把它们和函数放到一起。    

这和编译原理的 ε-closure 其实异曲同工。